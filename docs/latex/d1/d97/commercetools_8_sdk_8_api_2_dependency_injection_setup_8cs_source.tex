\hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source}{}\doxysection{Dependency\+Injection\+Setup.\+cs}
\label{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source}\index{/Users/mgeorge/workspace/commercetools-\/dotnet-\/api-\/sdk/commercetools.Sdk/commercetools.Sdk.Api/DependencyInjectionSetup.cs@{/Users/mgeorge/workspace/commercetools-\/dotnet-\/api-\/sdk/commercetools.Sdk/commercetools.Sdk.Api/DependencyInjectionSetup.cs}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00001}00001 \textcolor{keyword}{using} System;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00002}00002 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk}{Sdk}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api}{Api}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_models}{Models}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_models_1_1_types}{Types}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00003}00003 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_base}{Base}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_serialization}{Serialization}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_serialization_1_1_mapper_type_retrievers}{MapperTypeRetrievers}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00004}00004 \textcolor{keyword}{using} Microsoft.Extensions.DependencyInjection;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00005}00005 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00006}00006 \textcolor{keyword}{using} System.Linq;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00007}00007 \textcolor{keyword}{using} System.Net.Http;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00008}00008 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk}{Sdk}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api}{Api}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_models}{Models}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_models_1_1_errors}{Errors}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00009}00009 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk}{Sdk}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api}{Api}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_models}{Models}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_models_1_1_products}{Products}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00010}00010 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_base}{Base}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_client}{Client}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00011}00011 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_base}{Base}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_client}{Client}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_client_1_1_tokens}{Tokens}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00012}00012 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_base}{Base}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_registration}{Registration}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00013}00013 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_base}{Base}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_serialization}{Serialization}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00014}00014 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk}{Sdk}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api}{Api}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_client}{Client}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00015}00015 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk}{Sdk}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api}{Api}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_serialization}{Serialization}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00016}00016 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk}{Sdk}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api}{Api}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_serialization}{Serialization}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api_1_1_serialization_1_1_mapper_type_retrievers}{MapperTypeRetrievers}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00017}00017 \textcolor{keyword}{using} Microsoft.Extensions.Configuration;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00019}00019 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_api}{commercetools.Sdk.Api}}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00020}00020 \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00021}00021     \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keyword}{class }DependencyInjectionSetup}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00022}00022     \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00023}00023         \textcolor{keyword}{public} \textcolor{keyword}{static} IHttpClientBuilder UseCommercetoolsApi(\textcolor{keyword}{this} IServiceCollection services,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00024}00024             IConfiguration configuration,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00025}00025             \textcolor{keywordtype}{string} clientName = DefaultClientNames.Api,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00026}00026             Func<string, IConfiguration, IServiceProvider, ITokenProvider> tokenProviderSupplier = \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00027}00027         \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00028}00028             var clients = \textcolor{keyword}{new} List<string>()}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00029}00029             \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00030}00030                 clientName}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00031}00031             \};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00032}00032             services.AddSingleton(c => \mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_client_1_1_api_factory}{ApiFactory}}.\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_client_1_1_api_factory_a47bfbac97c4b3c19ac437b8b5204b2d2}{Create}}(c.GetService<\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client}{IClient}}>()));}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00033}00033             \mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration}{IClientConfiguration}} clientConfiguration = configuration.GetSection(clientName).Get<\mbox{\hyperlink{classcommercetools_1_1_base_1_1_client_1_1_client_configuration}{ClientConfiguration}}>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00034}00034             \textcolor{keywordflow}{if} (clientConfiguration.\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration_a3fd33488d0c6b73bb49ef45a026552a2}{ProjectKey}} != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00035}00035             \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00036}00036                 services.AddSingleton(c => \mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_client_1_1_api_factory}{ApiFactory}}.\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_client_1_1_api_factory_a47bfbac97c4b3c19ac437b8b5204b2d2}{Create}}(c.GetService<\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client}{IClient}}>(), clientConfiguration.\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration_a3fd33488d0c6b73bb49ef45a026552a2}{ProjectKey}}));}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00037}00037             \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00038}00038             \textcolor{keywordflow}{return} services.UseCommercetoolsApi(configuration, clients,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00039}00039                 tokenProviderSupplier ?? CreateDefaultTokenProvider).Single().Value;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00040}00040         \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00041}00041 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00042}00042         \textcolor{keyword}{public} \textcolor{keyword}{static} IDictionary<string, IHttpClientBuilder> UseCommercetoolsApi(\textcolor{keyword}{this} IServiceCollection services,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00043}00043             IConfiguration configuration, IList<string> clients,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00044}00044             Func<string, IConfiguration, IServiceProvider, ITokenProvider> tokenProviderSupplier = \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00045}00045         \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00046}00046             services.UseCommercetoolsApiSerialization();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00047}00047 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00048}00048             clients.ToList().ForEach(clientName =>}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00049}00049             \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00050}00050                 \mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration}{IClientConfiguration}} clientConfiguration =}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00051}00051                     configuration.GetSection(clientName).Get<ClientConfiguration>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00052}00052                 services.AddSingleton(c => \mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_client_1_1_api_factory}{ApiFactory}}.\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_client_1_1_api_factory_a47bfbac97c4b3c19ac437b8b5204b2d2}{Create}}(c.GetService<\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client}{IClient}}>(), clientConfiguration.\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration_a3fd33488d0c6b73bb49ef45a026552a2}{ProjectKey}}));}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00053}00053             \});}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00054}00054 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00055}00055             \textcolor{keywordflow}{return} services.UseHttpApi(configuration, clients,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00056}00056                 serviceProvider => serviceProvider.GetService<\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_serialization_1_1_serializer_service}{SerializerService}}>(),}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00057}00057                 message => typeof(\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_models_1_1_errors_1_1_error_response}{ErrorResponse}}),}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00058}00058                 tokenProviderSupplier ?? CreateDefaultTokenProvider);}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00059}00059         \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00061}00061         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} UseCommercetoolsApiSerialization(\textcolor{keyword}{this} IServiceCollection services)}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00062}00062         \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00063}00063             services.UseRegistration();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00064}00064             services.UseSerialization();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00065}00065             services.AddSingleton<\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_serialization_1_1_mapper_type_retrievers_1_1_i_mapper_type_retriever}{IMapperTypeRetriever<IFieldContainer>}}, \mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_serialization_1_1_mapper_type_retrievers_1_1_field_mapper_type_retriever}{FieldMapperTypeRetriever}}>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00066}00066             services.AddSingleton<\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_serialization_1_1_mapper_type_retrievers_1_1_i_mapper_type_retriever}{IMapperTypeRetriever<IAttribute>}}, \mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_serialization_1_1_mapper_type_retrievers_1_1_attribute_mapper_type_retriever}{AttributeMapperTypeRetriever}}>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00067}00067             services.AddSingleton<\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_serialization_1_1_mapper_type_retrievers_1_1_attribute_type_retriever}{AttributeTypeRetriever}}>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00068}00068             services.AddSingleton<\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_api_1_1_serialization_1_1_serializer_service}{SerializerService}}>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00069}00069         \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00070}00070 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00071}00071         \textcolor{keyword}{public} \textcolor{keyword}{static} \mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_tokens_1_1_i_token_provider}{ITokenProvider}} CreateDefaultTokenProvider(\textcolor{keywordtype}{string} clientName, IConfiguration configuration, IServiceProvider serviceProvider)}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00072}00072         \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00073}00073             var httpClientFactory = serviceProvider.GetService<IHttpClientFactory>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00074}00074             var clientConfiguration = configuration.GetSection(clientName).Get<\mbox{\hyperlink{classcommercetools_1_1_base_1_1_client_1_1_client_configuration}{ClientConfiguration}}>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00075}00075             \textcolor{keywordflow}{return} \mbox{\hyperlink{classcommercetools_1_1_base_1_1_client_1_1_token_provider_factory}{TokenProviderFactory}}.\mbox{\hyperlink{classcommercetools_1_1_base_1_1_client_1_1_token_provider_factory_a56c0a6b52a3b71dc0f3f33ae60cabc5b}{CreateClientCredentialsTokenProvider}}(clientConfiguration, httpClientFactory);}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00076}00076         \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00077}00077     \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_api_2_dependency_injection_setup_8cs_source_l00078}00078 \}}

\end{DoxyCode}
