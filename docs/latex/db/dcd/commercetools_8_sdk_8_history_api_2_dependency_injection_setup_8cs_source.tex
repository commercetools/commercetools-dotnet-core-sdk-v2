\hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source}{}\doxysection{Dependency\+Injection\+Setup.\+cs}
\label{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source}\index{/Users/mgeorge/workspace/commercetools-\/dotnet-\/api-\/sdk/commercetools.Sdk/commercetools.Sdk.HistoryApi/DependencyInjectionSetup.cs@{/Users/mgeorge/workspace/commercetools-\/dotnet-\/api-\/sdk/commercetools.Sdk/commercetools.Sdk.HistoryApi/DependencyInjectionSetup.cs}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00001}00001 \textcolor{keyword}{using} System;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00002}00002 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00003}00003 \textcolor{keyword}{using} System.Linq;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00004}00004 \textcolor{keyword}{using} System.Net.Http;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00005}00005 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_base}{Base}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_client}{Client}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00006}00006 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_base}{Base}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_client}{Client}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_client_1_1_tokens}{Tokens}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00007}00007 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_base}{Base}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_registration}{Registration}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00008}00008 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_base}{Base}}.\mbox{\hyperlink{namespacecommercetools_1_1_base_1_1_serialization}{Serialization}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00009}00009 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk}{Sdk}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_history_api}{HistoryApi}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_history_api_1_1_client}{Client}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00010}00010 \textcolor{keyword}{using} \mbox{\hyperlink{namespacecommercetools}{commercetools}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk}{Sdk}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_history_api}{HistoryApi}}.\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_history_api_1_1_serialization}{Serialization}};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00011}00011 \textcolor{keyword}{using} Microsoft.Extensions.Configuration;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00012}00012 \textcolor{keyword}{using} Microsoft.Extensions.DependencyInjection;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00014}00014 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacecommercetools_1_1_sdk_1_1_history_api}{commercetools.Sdk.HistoryApi}}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00015}00015 \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00016}00016     \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keyword}{class }DependencyInjectionSetup}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00017}00017     \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00018}00018         \textcolor{keyword}{public} \textcolor{keyword}{static} IHttpClientBuilder UseCommercetoolsHistoryApi(\textcolor{keyword}{this} IServiceCollection services,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00019}00019             IConfiguration configuration,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00020}00020             \textcolor{keywordtype}{string} clientName = DefaultClientNames.HistoryApi,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00021}00021             Func<string, IConfiguration, IServiceProvider, ITokenProvider> tokenProviderSupplier = \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00022}00022         \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00023}00023             var clients = \textcolor{keyword}{new} List<string>()}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00024}00024             \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00025}00025                 clientName}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00026}00026             \};}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00027}00027             services.AddSingleton(c => \mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_history_api_1_1_client_1_1_history_api_factory}{HistoryApiFactory}}.\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_history_api_1_1_client_1_1_history_api_factory_abcd2ee42e1aedda97f62f6c518e99eaf}{Create}}(c.GetService<\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client}{IClient}}>()));}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00028}00028             \mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration}{IClientConfiguration}} clientConfiguration = configuration.GetSection(clientName).Get<\mbox{\hyperlink{classcommercetools_1_1_base_1_1_client_1_1_client_configuration}{ClientConfiguration}}>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00029}00029             \textcolor{keywordflow}{if} (clientConfiguration.\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration_a3fd33488d0c6b73bb49ef45a026552a2}{ProjectKey}} != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00030}00030             \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00031}00031                 services.AddSingleton(c => \mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_history_api_1_1_client_1_1_history_api_factory}{HistoryApiFactory}}.\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_history_api_1_1_client_1_1_history_api_factory_abcd2ee42e1aedda97f62f6c518e99eaf}{Create}}(c.GetService<\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client}{IClient}}>(), clientConfiguration.\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration_a3fd33488d0c6b73bb49ef45a026552a2}{ProjectKey}}));}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00032}00032             \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00034}00034             \textcolor{keywordflow}{return} services.UseCommercetoolsHistoryApi(configuration, clients, tokenProviderSupplier ?? CreateDefaultTokenProvider).Single().Value;}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00035}00035         \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00037}00037         \textcolor{keyword}{public} \textcolor{keyword}{static} IDictionary<string, IHttpClientBuilder> UseCommercetoolsHistoryApi(\textcolor{keyword}{this} IServiceCollection services,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00038}00038             IConfiguration configuration, IList<string> clients,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00039}00039             Func<string, IConfiguration, IServiceProvider, ITokenProvider> tokenProviderSupplier)}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00040}00040         \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00041}00041             services.AddSingleton(configuration);}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00042}00042             services.UseCommercetoolsHistoryApiSerialization();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00043}00043             clients.ToList().ForEach(clientName =>}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00044}00044             \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00045}00045                 \mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration}{IClientConfiguration}} clientConfiguration =}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00046}00046                     configuration.GetSection(clientName).Get<ClientConfiguration>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00047}00047                 services.AddSingleton(c => \mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_history_api_1_1_client_1_1_history_api_factory}{HistoryApiFactory}}.\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_history_api_1_1_client_1_1_history_api_factory_abcd2ee42e1aedda97f62f6c518e99eaf}{Create}}(c.GetService<\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client}{IClient}}>(), clientConfiguration.\mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_i_client_configuration_a3fd33488d0c6b73bb49ef45a026552a2}{ProjectKey}}));}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00048}00048             \});}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00049}00049 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00050}00050             \textcolor{keywordflow}{return} services.UseHttpApi(configuration, clients,}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00051}00051                 serviceProvider => serviceProvider.GetService<\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_history_api_1_1_serialization_1_1_serializer_service}{SerializerService}}>(),}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00052}00052                 message => typeof(Object),}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00053}00053                 tokenProviderSupplier ?? CreateDefaultTokenProvider);}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00054}00054         \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00055}00055 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00056}00056         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{void} UseCommercetoolsHistoryApiSerialization(\textcolor{keyword}{this} IServiceCollection services)}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00057}00057         \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00058}00058             services.UseRegistration();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00059}00059             services.UseSerialization();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00060}00060             services.AddSingleton<\mbox{\hyperlink{classcommercetools_1_1_sdk_1_1_history_api_1_1_serialization_1_1_serializer_service}{SerializerService}}>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00061}00061         \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00063}00063         \textcolor{keyword}{public} \textcolor{keyword}{static} \mbox{\hyperlink{interfacecommercetools_1_1_base_1_1_client_1_1_tokens_1_1_i_token_provider}{ITokenProvider}} CreateDefaultTokenProvider(\textcolor{keywordtype}{string} clientName, IConfiguration configuration, IServiceProvider serviceProvider)}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00064}00064         \{}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00065}00065             var httpClientFactory = serviceProvider.GetService<IHttpClientFactory>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00066}00066             var clientConfiguration = configuration.GetSection(clientName).Get<\mbox{\hyperlink{classcommercetools_1_1_base_1_1_client_1_1_client_configuration}{ClientConfiguration}}>();}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00067}00067             \textcolor{keywordflow}{return} \mbox{\hyperlink{classcommercetools_1_1_base_1_1_client_1_1_token_provider_factory}{TokenProviderFactory}}.\mbox{\hyperlink{classcommercetools_1_1_base_1_1_client_1_1_token_provider_factory_a56c0a6b52a3b71dc0f3f33ae60cabc5b}{CreateClientCredentialsTokenProvider}}(clientConfiguration, httpClientFactory);}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00068}00068         \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00069}00069     \}}
\DoxyCodeLine{\Hypertarget{commercetools_8_sdk_8_history_api_2_dependency_injection_setup_8cs_source_l00070}00070 \}}

\end{DoxyCode}
